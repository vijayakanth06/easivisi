{% extends "base.html" %}

{% block title %}Datasets{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1><i class="fas fa-database"></i> Dataset Management</h1>
        <p>Create, upload, and manage your training datasets</p>
    </div>
</div>

<div class="container">
    <!-- Create Dataset Section -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-folder-plus"></i> Create New Dataset</h2>
        </div>
        <div class="card-body">
            <form id="createDatasetForm" class="inline-form">
                <div class="form-group">
                    <input type="text" id="datasetName" class="form-input" placeholder="Dataset name (e.g., my_objects)"
                        required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Create Dataset
                </button>
            </form>
        </div>
    </div>

    <!-- Datasets List -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-list"></i> Your Datasets</h2>
        </div>
        <div class="card-body">
            {% if datasets|length == 0 %}
            <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <h3>No datasets yet</h3>
                <p>Create your first dataset to get started</p>
            </div>
            {% else %}
            <div class="dataset-grid">
                {% for dataset in datasets %}
                <div class="dataset-card" data-name="{{ dataset.name }}">
                    <div class="dataset-icon">
                        <i class="fas fa-images"></i>
                    </div>
                    <div class="dataset-info">
                        <h3>{{ dataset.name }}</h3>
                        <div class="dataset-stats">
                            <span><i class="fas fa-image"></i> {{ dataset.train_images + dataset.val_images }}
                                images</span>
                            <span><i class="fas fa-tag"></i> {{ dataset.classes|length }} classes</span>
                        </div>
                        <div class="dataset-splits">
                            <span class="badge badge-success">Train: {{ dataset.train_images }}</span>
                            <span class="badge badge-info">Val: {{ dataset.val_images }}</span>
                        </div>
                        {% if dataset.has_yaml %}
                        <span class="badge badge-primary"><i class="fas fa-check"></i> Ready for training</span>
                        {% else %}
                        <span class="badge badge-warning"><i class="fas fa-exclamation"></i> Needs configuration</span>
                        {% endif %}
                    </div>
                    <div class="dataset-actions">
                        <a href="/dataset/{{ dataset.name }}" class="btn btn-sm btn-secondary">
                            <i class="fas fa-eye"></i> View
                        </a>
                        <a href="/annotate/{{ dataset.name }}" class="btn btn-sm btn-primary">
                            <i class="fas fa-edit"></i> Annotate
                        </a>
                        <button class="btn btn-sm btn-danger" onclick="deleteDataset('{{ dataset.name }}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Create dataset
    document.getElementById('createDatasetForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('datasetName').value.trim();

        if (!name) {
            showToast('Please enter a dataset name', 'error');
            return;
        }

        try {
            const result = await apiCall('/api/dataset/create', {
                method: 'POST',
                body: JSON.stringify({ name })
            });

            showToast(`Dataset "${result.name}" created!`, 'success');
            setTimeout(() => location.reload(), 1000);
        } catch (error) {
            // Error already shown by apiCall
        }
    });

    // Delete dataset
    async function deleteDataset(name) {
        if (!confirm(`Are you sure you want to delete "${name}"? This cannot be undone.`)) {
            return;
        }

        try {
            await apiCall(`/api/dataset/${name}/delete`, {
                method: 'DELETE'
            });

            showToast('Dataset deleted', 'success');
            document.querySelector(`.dataset-card[data-name="${name}"]`).remove();
        } catch (error) {
            // Error already shown by apiCall
        }
    }
</script>
{% endblock %}